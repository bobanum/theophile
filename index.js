(()=>{"use strict";class e{static name="Plugin";static plugins={};static parent=null;static hooks={beforeFetch:[],fetched:[],beforeMount:[],beforeCleanup:[],cleanedup:[],mounted:[],afterMounted:[]};static registerPlugin(e,t=null){return t=t||e.name,this.parent?this.parent.registerPlugin(e,`${this.name}.${t}`):(this.plugins[t]||(this.plugins[t]=e,e.init(this)),this)}static addHook(e,t){if(!this.hooks[e])throw new Error(`Unknown hook ${e}`);return this.hooks[e].push(t),this}static beforeFetch(e){return this.addHook("beforeFetch",e)}static fetched(e){return this.addHook("fetched",e)}static beforeMount(e){return this.addHook("beforeMount",e)}static beforeCleanup(e){return this.addHook("beforeCleanup",e)}static cleanedup(e){return this.addHook("cleanedup",e)}static mounted(e){return this.addHook("mounted",e)}static afterMounted(e){return this.addHook("afterMounted",e)}static execHook(e,...t){if(!this.hooks[e])throw new Error(`Unknown hook ${e}`);return Promise.all(this.hooks[e].map((e=>e(...t))))}static async init(e="."){console.warn(`Plugin ${this.name} is not initialized`)}}class t extends e{static name="Theophile";static loaded=!1;static async exec(e){this.trace("Theophile BEGIN"),await this.execHook("beforeCreate",e),await this.execHook("created",e),await this.execHook("beforeMount",e),await this.execHook("mounted",e),await this.execHook("beforeUpdate",e),await this.execHook("updated",e),await this.execHook("beforeUnmount",e),await this.execHook("unmounted",e),this.trace("Theophile END")}static async init(e="."){}static get root(){return this._root}static set root(e){if(e.match(/^[a-zA-Z0-9]+:\/\//))return this._root=new URL(e);var t=new URL(location);if("/"===e[0])t.pathname=e.replace(/\/*$/,"/");else{var r=t.pathname.split("/").slice(0,-1);r.push(e),t.pathname=r.join("/")}return this._root=t}static siteURL(e){if(e&&e.match(/^[a-zA-Z][a-zA-Z0-9+.-]*?:\/\//))return new URL(e);var t=new URL(this.root);return e?"/"===e[0]?(t.pathname=e,t):(t.pathname+=e,t):t}static appURL(e){if(e&&e.match(/^[a-zA-Z][a-zA-Z0-9+.-]*?:\/\//))return e;var t=new URL("file:///C:/Users/bo_ba/Github/Github_bobanum/theophile/src/Theophile.js"),r=t.pathname.split("/").slice(0,-2);return e&&r.push(e),t.pathname=r.join("/"),t}static normalizeString(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9_\.\-]/g,"_").replace(/_+/g,"_")}static loadJson(e){return new Promise(((t,r)=>{var o=new XMLHttpRequest;o.open("get",e),o.responseType="json",o.addEventListener("load",(e=>404===e.target.status?r(e.target.statusText):t(e.target.response))),o.addEventListener("error",(e=>{r(e.target)})),o.onerror=function(){console.error("XHR error "+o.status)},o.upload.onloadstart=function(){console.log("onloadstart"+o.status)},o.upload.onloadend=function(){console.log("onloadend"+o.status)},o.upload.onerror=function(){console.log("error"+o.status)};try{o.send(null)}catch(e){r(e)}}))}static loadDataSet(e,t){var r=e.dataset;t=t||{};for(let e in r)"th"===e?this.parseConfigString(r[e],t):null!==e.match(/^th[A-Z]/)&&this.setCompoundProperty(e.slice(2),r[e],t);return t}static setCompoundProperty(e,t,r){const o=e.replace(/[A-Z]/g,(e=>"-"+e)).replace(/^-/,"").toLowerCase().split("-");let s=r=r||{};o.slice(0,-1).forEach((e=>{s[e]||(s[e]={}),s=s[e]})),s[o.slice(-1)[0]]=this.parseConfigString(t,s[o.slice(-1)[0]])}static parseConfigString(e,t){return e?e.indexOf(":")<0?e:(t=t||{},e.replace(/\s*;\s*$/,"").split(/;/).forEach((e=>{var r=e.match(/\s*([a-zA-z_-][a-zA-z0-9_-]*)\s*:\s*(.*)\s*/);r&&this.setCompoundProperty(r[1],r[2],t)})),t):{}}}t.trace=()=>{},t.registerPlugin(class extends e{static name="Reference";static async init(e){await super.init(e),this.refsDocuments={}}static findReferences(){var e=Array.from(document.querySelectorAll(".th-references")).map((e=>this.processGroup(e)));return Promise.all(e)}static async processGroup(e){var t=Array.from(e.querySelectorAll("a"));for(await Promise.all(t.map((e=>this.processRef(e))));e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}static async processRef(e){const t=e.getAttribute("href"),r=await this.getRefDocument(t);if(t.split("#")[1])console.error("Todo");else{for(r.head.querySelectorAll("style,link").forEach((t=>{e.ownerDocument.head.appendChild(t)}));r.body.firstChild;)e.parentNode.insertBefore(r.body.firstChild,e);e.parentNode.removeChild(e)}}static getRefDocument(e){return e=e.split("#")[0],this.refsDocuments[e]?Promise.resolve(this.refsDocuments[e]):new Promise((t=>{const r=new XMLHttpRequest;r.open("get",e),r.responseType="document",r.addEventListener("load",(r=>{const o=r.target.response;this.refsDocuments[e]=o,t(o)})),r.send()}))}static async prepare(){return await super.prepare(),await this.findReferences()}})})();